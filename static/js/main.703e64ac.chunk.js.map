{"version":3,"sources":["Loading.tsx","CaseChart.tsx","actions.ts","CountryPicker.tsx","Loaded.tsx","Error.tsx","utils.ts","App.tsx","data.ts","reducers.ts","epics.ts","store.ts","index.tsx"],"names":["Loading","progress","useSelector","state","covid","done","total","population","selectDataToRenderIntoChart","ui","pickedCountries","map","pickedCountry","name","data","where","row","iso_code","toArray","date","getTime","total_cases","type","CaseChart","cases","options","title","text","xAxis","yAxis","series","console","log","highcharts","Highcharts","makeProgressAction","coutrySelector","select","location","distinct","orderBy","toPairs","active","includes","filter","searchText","toLowerCase","startsWith","CountryPicker","dispatch","useDispatch","allCountries","selected","key","style","fontWeight","onClick","_","countryCode","onChange","e","search","target","value","id","Loaded","Error","message","assertNever","x","App","className","parseCovidCSV","of","fromCSV","pipe","df","parseDates","parseInts","parsePopulationCSV","renameSeries","mergeCovidPopulation","populationLatest","groupBy","group","maxYear","summarize","year","Series","max","pop","first","inflate","computeLatestPopulation","join","errorReducer","action","loadingReducer","response","loadedReducer","country","countries","c","fromXhr","url","xhr","XMLHttpRequest","responseType","progress$","Observable","subscriber","addEventListener","ev","next","loaded","result$","readyState","status","complete","error","open","send","result","rootEpic","combineEpics","action$","covidData$","flatMap","update","merge","populationData$","combinedProgress$","item","filterForResult","data$","combinedResults$","zip","initialState","epicMiddleware","createEpicMiddleware","store","configureStore","reducer","middleware","run","rootElement","document","getElementById","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.703e64ac.chunk.js","sourcesContent":["import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { LoadingState } from \"./store\";\n\nexport const Loading = () => {\n  const progress = useSelector((state: LoadingState) => state.progress);\n  return (\n    <div>\n      <div>\n        loading covid: {progress.covid.done} / {progress.covid.total}\n      </div>\n      <div>\n        loading population: {progress.population.done} /{\" \"}\n        {progress.population.total}\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\n\nimport Highcharts from \"highcharts\";\nimport HighchartsReact from \"highcharts-react-official\";\nimport { LoadedState } from \"./store\";\nimport { useSelector } from \"react-redux\";\n\nconst selectDataToRenderIntoChart = (\n  state: LoadedState,\n): {\n  name: string;\n  data: [Date, number][];\n  type: \"line\";\n}[] =>\n  state.ui.pickedCountries.map((pickedCountry: string) => ({\n    name: pickedCountry,\n    data: state.data\n      .where(row => row.iso_code === pickedCountry)\n      .toArray()\n      .map(row => [row.date.getTime(), row.total_cases]),\n    type: \"line\",\n  }));\n\nexport const CaseChart = () => {\n  const cases = useSelector(selectDataToRenderIntoChart);\n\n  const options: Highcharts.Options = {\n    title: {\n      text: \"Cases over time\",\n    },\n    xAxis: {\n      type: \"datetime\",\n      title: {\n        text: \"Date\",\n      },\n    },\n    yAxis: {\n      type: \"logarithmic\",\n    },\n    series: cases,\n  };\n\n  console.log(cases);\n  return (\n    <div>\n      <HighchartsReact highcharts={Highcharts} options={options} />\n    </div>\n  );\n};\n","import { IDataFrame } from \"data-forge\";\n\nexport type Action =\n  | InitialAction\n  | ErrorDuringFetchAction\n  | FetchSuccessAction\n  | CountryToggleAction\n  | CountrySearchChangedAction\n  | ProgressAction;\n\nexport interface InitialAction {\n  type: \"initialized\";\n}\nexport const makeInitialized = (): InitialAction => ({\n  type: \"initialized\",\n});\n\nexport interface ErrorDuringFetchAction {\n  type: \"error-during-fetch\";\n  message: string;\n}\nexport const makeErrorDuringFetch = (\n  message: string,\n): ErrorDuringFetchAction => ({\n  type: \"error-during-fetch\",\n  message,\n});\n\nexport interface FetchSuccessAction {\n  type: \"fetch-success\";\n  response: IDataFrame;\n}\nexport const makeFetchSuccess = (response: IDataFrame): FetchSuccessAction => ({\n  type: \"fetch-success\",\n  response,\n});\n\nexport interface CountryToggleAction {\n  type: \"country-toggled\";\n  countryCode: string;\n}\nexport const makeCountryToggleAction = (\n  countryCode: string,\n): CountryToggleAction => ({\n  type: \"country-toggled\",\n  countryCode,\n});\n\nexport interface CountrySearchChangedAction {\n  type: \"country-search-changed\";\n  search: string;\n}\n\nexport const makeCoutrySearchChangedAction = (\n  search: string,\n): CountrySearchChangedAction => ({\n  type: \"country-search-changed\",\n  search,\n});\n\nexport interface ProgressAction {\n  type: \"progress\";\n  target: \"covid\" | \"population\";\n  done: number;\n  total: number;\n}\n\nexport const makeProgressAction = (progress: {\n  target: \"covid\" | \"population\";\n  done: number;\n  total: number;\n}): ProgressAction => {\n  return { ...progress, type: \"progress\" };\n};\n","import React, { CSSProperties } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\n\nimport { LoadedState } from \"./store\";\n\nimport { includes } from \"lodash/fp\";\nimport {\n  makeCountryToggleAction,\n  makeCoutrySearchChangedAction,\n} from \"./actions\";\n\nconst coutrySelector = (state: LoadedState) =>\n  state.data\n    .select(\n      ({ iso_code, location }: { iso_code: string; location: string }) => ({\n        iso_code,\n        location,\n      }),\n    )\n    .distinct(row => row.iso_code)\n    .orderBy(row => row.location)\n    .toPairs()\n    .map(([_, row]) => ({\n      ...row,\n      active: includes(row.iso_code)(state.ui.pickedCountries),\n    }))\n    .filter(\n      row =>\n        row.active ||\n        (state.ui.searchText !== \"\" &&\n          row.location\n            .toLowerCase()\n            .startsWith(state.ui.searchText.toLowerCase())),\n    );\n\nexport const CountryPicker = () => {\n  const dispatch = useDispatch();\n\n  const boldIfSelected = (selected: boolean): CSSProperties => ({\n    fontWeight: selected ? \"bold\" : \"normal\",\n  });\n\n  const allCountries = useSelector(coutrySelector).map(\n    ({ iso_code, location, active }) => (\n      <li\n        key={iso_code}\n        style={boldIfSelected(active)}\n        onClick={_ => dispatch(makeCountryToggleAction(iso_code))}\n      >\n        {location}\n      </li>\n    ),\n  );\n\n  const searchText = useSelector((state: LoadedState) => state.ui.searchText);\n\n  return (\n    <div>\n      <label>\n        Country Picker\n        <input\n          type=\"text\"\n          name=\"search\"\n          onChange={e =>\n            dispatch(makeCoutrySearchChangedAction(e.target.value))\n          }\n          value={searchText}\n        />\n        <ul id=\"countries\">{allCountries}</ul>\n      </label>\n    </div>\n  );\n};\n","import React from \"react\";\n\nimport { CaseChart } from \"./CaseChart\";\nimport { CountryPicker } from \"./CountryPicker\";\n\nexport const Loaded = () => {\n  return (\n    <div>\n      <CountryPicker />\n      <CaseChart />\n    </div>\n  );\n};\n","import React from \"react\";\n\nimport { ErrorState } from \"./store\";\nimport { useSelector } from \"react-redux\";\n\nexport const Error = () => {\n  const message = useSelector((state: ErrorState) => state.message);\n  return <div>Error: {message}</div>;\n};\n","export function assertNever(x: never): never {\n    throw new Error(\"Unexpected object: \" + x);\n}","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport \"./App.css\";\n\nimport { State } from \"./store\";\n\nimport { Loading } from \"./Loading\";\nimport { Loaded } from \"./Loaded\";\nimport { Error } from \"./Error\";\n\nimport { assertNever } from \"./utils\";\n\nexport const App = () => {\n  const state: State = useSelector<State, State>(_ => _);\n  return (\n    <div className=\"App\">\n      {((state: State) => {\n        switch (state.type) {\n          case \"loading\":\n            return <Loading />;\n          case \"loaded\":\n            return <Loaded />;\n          case \"error\":\n            return <Error />;\n          default:\n            return assertNever(state);\n        }\n      })(state)}\n    </div>\n  );\n};\n","import { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { fromCSV, IDataFrame, Series } from 'data-forge';\n\ninterface CovidRow {\n    iso_code: string,\n}\n\ninterface PopulationRow {\n    \"iso_code\": string,\n    \"population\": string,\n    \"year\": number,\n}\n\nexport const parseCovidCSV = (data: string): Observable<IDataFrame> =>\n    of(fromCSV(data))\n        .pipe(\n            map((df: IDataFrame): IDataFrame => df.parseDates('date')),\n            map((df: IDataFrame): IDataFrame => df.parseInts('total_cases')),\n        );\n\nexport const parsePopulationCSV = (data: string): Observable<IDataFrame> =>\n    of(fromCSV(data))\n        .pipe(\n            map(\n                (df: IDataFrame): IDataFrame => df.parseInts(['Value', 'Year'])\n            ),\n            map((df: IDataFrame): IDataFrame => df.renameSeries({\n                \"Year\": \"year\",\n                \"Country Code\": \"iso_code\",\n                \"Value\": \"population\",\n            }))\n        );\n\nexport const transformCsvData = (data: IDataFrame): IDataFrame => data;\n\ntype Maximums = Map<string, number>;\n\ntype Accumulator = {\n    maximums: Maximums,\n    result: IDataFrame,\n}\n\nconst computeLatestPopulation = (population: IDataFrame): IDataFrame =>\n    population\n        .groupBy(row => row.iso_code)\n        .select(group => {\n            const { year: maxYear } = group.summarize({ year: Series.max });\n            const pop = group.where(row => row.year === maxYear).first().population;\n            return {\n                iso_code: group.first().iso_code,\n                population: pop,\n            };\n        }).inflate();\n\nexport const mergeCovidPopulation = (covid: IDataFrame, population: IDataFrame): IDataFrame => {\n    const populationLatest = computeLatestPopulation(population);\n    console.log(covid.toArray());\n    return covid.join(\n        populationLatest,\n        (covid: CovidRow) => covid.iso_code,\n        (pop: PopulationRow) => pop.iso_code,\n        (covid: CovidRow, pop: PopulationRow | null) => (\n            {\n                ...covid,\n                population: pop ? pop.population : 0\n            }\n        )\n    );\n};\n","import { initialState, State, LoadedState, LoadingState } from \"./store\";\n\nimport { Action } from \"./actions\";\nimport { transformCsvData } from \"./data\";\n\nimport { assertNever } from \"./utils\";\n\nimport { includes, filter } from \"lodash/fp\";\n\nconst errorReducer = (state: State, action: Action): State => state;\n\nconst loadingReducer = (state: LoadingState, action: Action): State => {\n  switch (action.type) {\n    case \"fetch-success\":\n      return {\n        type: \"loaded\",\n        data: transformCsvData(action.response),\n        ui: {\n          pickedCountries: [\"USA\"],\n          searchText: \"\",\n        },\n      };\n    case \"progress\":\n      return {\n        ...state,\n        progress: {\n          ...state.progress,\n          [action.target]: {\n            done: action.done,\n            total: state.progress[action.target].total,\n            ...(action.total !== 0 && { total: action.total }),\n          },\n        },\n      };\n    default:\n      return state;\n  }\n};\n\nconst loadedReducer = (state: LoadedState, action: Action): State => {\n  switch (action.type) {\n    case \"country-toggled\":\n      const toggleCountryToPicked = (\n        country: string,\n        countries: string[],\n      ): string[] => {\n        if (includes(country)(countries)) {\n          return filter(c => c !== country, countries);\n        }\n\n        return [country, ...countries];\n      };\n\n      return {\n        ...state,\n        ui: {\n          ...state.ui,\n          pickedCountries: toggleCountryToPicked(\n            action.countryCode,\n            state.ui.pickedCountries,\n          ),\n        },\n      };\n    case \"country-search-changed\":\n      return { ...state, ui: { ...state.ui, searchText: action.search } };\n    default:\n      return state;\n  }\n};\n\nexport const reducer = (state: State = initialState, action: Action): State => {\n  switch (state.type) {\n    case \"error\":\n      return errorReducer(state, action);\n    case \"loading\":\n      return loadingReducer(state, action);\n    case \"loaded\":\n      return loadedReducer(state, action);\n    default:\n      return assertNever(state);\n  }\n};\n","import { Observable, zip, merge } from \"rxjs\";\n\nimport { filter, flatMap, map } from \"rxjs/operators\";\n\nimport { Action, makeProgressAction, ProgressAction } from \"./actions\";\n\nimport { combineEpics } from \"redux-observable\";\n\nimport {\n  parseCovidCSV,\n  parsePopulationCSV,\n  mergeCovidPopulation,\n} from \"./data\";\nimport { IDataFrame } from \"data-forge\";\n\ntype DataResult =\n  | { type: \"success\"; data: IDataFrame }\n  | { type: \"error\"; reason: string };\n\ninterface Progress {\n  done: number;\n  total: number;\n}\n\nconst fromXhr = (\n  url: string,\n): {\n  progress: Observable<Progress>;\n  result: Observable<string>;\n} => {\n  const xhr = new XMLHttpRequest();\n  xhr.responseType = \"text\";\n  const progress$ = new Observable<Progress>((subscriber): void => {\n    xhr.addEventListener(\"progress\", ev =>\n      subscriber.next({\n        done: ev.loaded,\n        total: ev.total,\n      }),\n    );\n  });\n\n  const result$ = new Observable<string>(subscriber => {\n    xhr.addEventListener(\"readystatechange\", ev => {\n      if (xhr.readyState !== 4) {\n        return;\n      }\n\n      if (xhr.status === 200) {\n        subscriber.next(xhr.response);\n        subscriber.complete();\n      } else {\n        subscriber.error(xhr.response);\n      }\n    });\n  });\n\n  xhr.open(\"GET\", url);\n  xhr.send();\n  return { progress: progress$, result: result$ };\n};\n\nexport const startLoadingEpic = (\n  action$: Observable<Action>,\n): Observable<Action> => {\n  const covidData$: Observable<ProgressAction | DataResult> = action$.pipe(\n    filter((action: Action) => action.type === \"initialized\"),\n    flatMap(() => {\n      const { progress, result } = fromXhr(\n        \"https://covid.ourworldindata.org/data/owid-covid-data.csv\",\n      );\n      const progress$ = progress.pipe(\n        map((update: Progress) =>\n          makeProgressAction({ ...update, target: \"covid\" }),\n        ),\n      );\n\n      const result$ = result.pipe(\n        flatMap(parseCovidCSV),\n        map((data: IDataFrame): DataResult => ({ type: \"success\", data })),\n      );\n\n      return merge(progress$, result$);\n    }),\n  );\n\n  const populationData$: Observable<ProgressAction | DataResult> = action$.pipe(\n    filter((action: Action) => action.type === \"initialized\"),\n    flatMap(() => {\n      const { progress, result } = fromXhr(\n        \"https://raw.githubusercontent.com/datasets/population/master/data/population.csv\",\n      );\n      const progress$ = progress.pipe(\n        map((update: Progress) =>\n          makeProgressAction({ ...update, target: \"population\" }),\n        ),\n      );\n\n      const result$ = result.pipe(\n        flatMap(parsePopulationCSV),\n        map((data: IDataFrame): DataResult => ({ type: \"success\", data })),\n      );\n\n      return merge(progress$, result$);\n    }),\n  );\n\n  const combinedProgress$: Observable<ProgressAction> = merge(\n    covidData$,\n    populationData$,\n  ).pipe(\n    filter(item => item.type === \"progress\"),\n    map(item => item as ProgressAction),\n  );\n\n  const filterForResult = (data$: Observable<ProgressAction | DataResult>) =>\n    data$.pipe(filter(item => item.type === \"success\"));\n\n  const combinedResults$: Observable<Action> = zip(\n    filterForResult(covidData$),\n    filterForResult(populationData$),\n  ).pipe(\n    map(\n      ([covid, population]): Action => {\n        console.log(\"happened\");\n        if (covid.type === \"success\" && population.type === \"success\") {\n          return {\n            type: \"fetch-success\",\n            response: mergeCovidPopulation(covid.data, population.data),\n          };\n        } else {\n          return {\n            type: \"error-during-fetch\",\n            message: `Error: ${covid} or ${population} failed to fetch`,\n          };\n        }\n      },\n    ),\n  );\n\n  return merge(combinedProgress$, combinedResults$);\n};\n\nexport const rootEpic = combineEpics(startLoadingEpic);\n","import { configureStore } from \"@reduxjs/toolkit\";\nimport { reducer } from \"./reducers\";\nimport { createEpicMiddleware } from \"redux-observable\";\nimport { rootEpic } from \"./epics\";\nimport { makeInitialized } from \"./actions\";\nimport { IDataFrame } from \"data-forge\";\nimport { Store as ReduxStore } from \"redux\";\nimport { Action } from \"./actions\";\n\nexport type State = LoadingState | LoadedState | ErrorState;\n\ninterface Progress {\n  done: number;\n  total: number;\n}\nexport interface LoadingState {\n  type: \"loading\";\n  progress: {\n    covid: Progress;\n    population: Progress;\n  };\n}\n\nexport interface UIState {\n  pickedCountries: string[];\n  searchText: string;\n}\n\nexport interface LoadedState {\n  type: \"loaded\";\n  data: IDataFrame;\n  ui: UIState;\n}\n\nexport interface ErrorState {\n  type: \"error\";\n  message: string;\n}\n\nconst covidSizeEstimate = 2542856;\nconst populationSizeEstimate = 487991;\n\nexport const initialState: State = {\n  type: \"loading\",\n  progress: {\n    covid: { done: 0, total: covidSizeEstimate },\n    population: { done: 0, total: populationSizeEstimate },\n  },\n};\n\nexport type Store = ReduxStore<State, Action>;\n\nconst epicMiddleware = createEpicMiddleware();\nexport const store = configureStore({\n  reducer,\n  middleware: [epicMiddleware],\n});\nepicMiddleware.run(rootEpic);\n\nstore.dispatch(makeInitialized());\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport { App } from \"./App\";\n\nimport { Provider } from \"react-redux\";\nimport { store } from \"./store\";\n\nconst rootElement = document.getElementById(\"root\");\n\nReactDOM.render(\n  <Provider store={store}>\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>\n  </Provider>,\n  rootElement,\n);\n"],"sourceRoot":""}